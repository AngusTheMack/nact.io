{"version":3,"sources":["webpack:///path---lesson-reasonml-querying-802e8d6b8746e79dae24.js","webpack:///./.cache/json/lesson-reasonml-querying.json"],"names":["webpackJsonp","./node_modules/json-loader/index.js!./.cache/json/lesson-reasonml-querying.json","module","exports","data","allPostTitles","edges","node","frontmatter","title","lesson","category","chapter","type","fields","slug","postBySlug","html","timeToRead","excerpt","cover","date","tags","pathContext"],"mappings":"AAAAA,cAAc,qBAERC,kFACA,SAAUC,EAAQC,GCHxBD,EAAAC,SACAC,MACAC,eACAC,QAEAC,MACAC,aACAC,MAAA,UACAC,OAAA,EACAC,SAAA,WACAC,QAAA,EACAC,KAAA,UAEAC,QACAC,KAAA,eAKAR,MACAC,aACAC,MAAA,kBACAC,OAAA,EACAC,SAAA,WACAC,QAAA,EACAC,KAAA,UAEAC,QACAC,KAAA,uBAKAR,MACAC,aACAC,MAAA,sBACAC,OAAA,EACAC,SAAA,WACAC,QAAA,EACAC,KAAA,UAEAC,QACAC,KAAA,2BAKAR,MACAC,aACAC,MAAA,eACAC,OAAA,EACAC,SAAA,WACAC,QAAA,EACAC,KAAA,UAEAC,QACAC,KAAA,oBAKAR,MACAC,aACAC,MAAA,eACAC,OAAA,EACAC,SAAA,WACAC,QAAA,EACAC,KAAA,UAEAC,QACAC,KAAA,oBAKAR,MACAC,aACAC,MAAA,WACAC,OAAA,EACAC,SAAA,WACAC,QAAA,EACAC,KAAA,UAEAC,QACAC,KAAA,gBAKAR,MACAC,aACAC,MAAA,kBACAC,OAAA,EACAC,SAAA,WACAC,QAAA,EACAC,KAAA,UAEAC,QACAC,KAAA,uBAKAR,MACAC,aACAC,MAAA,WACAC,OAAA,EACAC,SAAA,WACAC,QAAA,EACAC,KAAA,UAEAC,QACAC,KAAA,iBAMAC,YACAC,KAAA;AACAC,WAAA,EACAC,QAAA,kJACAX,aACAC,MAAA,WACAW,MAAA,+CACAC,KAAA,aACAV,SAAA,WACAW,MACA,kBACA,OACA,SACA,iBAGAR,QACAC,KAAA,eAIAQ,aACAR,KAAA,YACAJ,SAAA","file":"path---lesson-reasonml-querying-802e8d6b8746e79dae24.js","sourcesContent":["webpackJsonp([2247064940371686400],{\n\n/***/ \"./node_modules/json-loader/index.js!./.cache/json/lesson-reasonml-querying.json\":\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\n\t\t\"data\": {\n\t\t\t\"allPostTitles\": {\n\t\t\t\t\"edges\": [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"node\": {\n\t\t\t\t\t\t\t\"frontmatter\": {\n\t\t\t\t\t\t\t\t\"title\": \"Persist\",\n\t\t\t\t\t\t\t\t\"lesson\": 1,\n\t\t\t\t\t\t\t\t\"category\": \"reasonml\",\n\t\t\t\t\t\t\t\t\"chapter\": 3,\n\t\t\t\t\t\t\t\t\"type\": \"lesson\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"fields\": {\n\t\t\t\t\t\t\t\t\"slug\": \"/persist\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"node\": {\n\t\t\t\t\t\t\t\"frontmatter\": {\n\t\t\t\t\t\t\t\t\"title\": \"Getting Started\",\n\t\t\t\t\t\t\t\t\"lesson\": 1,\n\t\t\t\t\t\t\t\t\"category\": \"reasonml\",\n\t\t\t\t\t\t\t\t\"chapter\": 2,\n\t\t\t\t\t\t\t\t\"type\": \"lesson\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"fields\": {\n\t\t\t\t\t\t\t\t\"slug\": \"/getting-started\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"node\": {\n\t\t\t\t\t\t\t\"frontmatter\": {\n\t\t\t\t\t\t\t\t\"title\": \"Actor Communication\",\n\t\t\t\t\t\t\t\t\"lesson\": 3,\n\t\t\t\t\t\t\t\t\"category\": \"reasonml\",\n\t\t\t\t\t\t\t\t\"chapter\": 2,\n\t\t\t\t\t\t\t\t\"type\": \"lesson\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"fields\": {\n\t\t\t\t\t\t\t\t\"slug\": \"/actor-communication\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"node\": {\n\t\t\t\t\t\t\t\"frontmatter\": {\n\t\t\t\t\t\t\t\t\"title\": \"Introduction\",\n\t\t\t\t\t\t\t\t\"lesson\": 1,\n\t\t\t\t\t\t\t\t\"category\": \"reasonml\",\n\t\t\t\t\t\t\t\t\"chapter\": 1,\n\t\t\t\t\t\t\t\t\"type\": \"lesson\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"fields\": {\n\t\t\t\t\t\t\t\t\"slug\": \"/introduction\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"node\": {\n\t\t\t\t\t\t\t\"frontmatter\": {\n\t\t\t\t\t\t\t\t\"title\": \"Snapshotting\",\n\t\t\t\t\t\t\t\t\"lesson\": 2,\n\t\t\t\t\t\t\t\t\"category\": \"reasonml\",\n\t\t\t\t\t\t\t\t\"chapter\": 3,\n\t\t\t\t\t\t\t\t\"type\": \"lesson\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"fields\": {\n\t\t\t\t\t\t\t\t\"slug\": \"/snapshotting\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"node\": {\n\t\t\t\t\t\t\t\"frontmatter\": {\n\t\t\t\t\t\t\t\t\"title\": \"Timeouts\",\n\t\t\t\t\t\t\t\t\"lesson\": 3,\n\t\t\t\t\t\t\t\t\"category\": \"reasonml\",\n\t\t\t\t\t\t\t\t\"chapter\": 3,\n\t\t\t\t\t\t\t\t\"type\": \"lesson\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"fields\": {\n\t\t\t\t\t\t\t\t\"slug\": \"/timeouts\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"node\": {\n\t\t\t\t\t\t\t\"frontmatter\": {\n\t\t\t\t\t\t\t\t\"title\": \"Stateful Actors\",\n\t\t\t\t\t\t\t\t\"lesson\": 2,\n\t\t\t\t\t\t\t\t\"category\": \"reasonml\",\n\t\t\t\t\t\t\t\t\"chapter\": 2,\n\t\t\t\t\t\t\t\t\"type\": \"lesson\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"fields\": {\n\t\t\t\t\t\t\t\t\"slug\": \"/stateful-actors\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"node\": {\n\t\t\t\t\t\t\t\"frontmatter\": {\n\t\t\t\t\t\t\t\t\"title\": \"Querying\",\n\t\t\t\t\t\t\t\t\"lesson\": 4,\n\t\t\t\t\t\t\t\t\"category\": \"reasonml\",\n\t\t\t\t\t\t\t\t\"chapter\": 2,\n\t\t\t\t\t\t\t\t\"type\": \"lesson\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"fields\": {\n\t\t\t\t\t\t\t\t\"slug\": \"/querying\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\t\t\t\"postBySlug\": {\n\t\t\t\t\"html\": \"<p>Actor systems don't live in a vacuum, they need to be available to the outside world. Commonly actor systems are fronted by REST APIs or RPC frameworks. REST and RPC style access patterns are blocking: a request comes in, it is processed, and finally returned to the sender using the original connection. To help bridge nact's non blocking nature, Nact provides a <code>query</code> function. Query returns a promise.</p>\\n<p>Similar to <code>dispatch</code>, <code>query</code> pushes a message on to an actor's mailbox, but differs in that it also creates a temporary actor. The temporary actor is passed into a function which returns the message to send to the target actor. When the temporary actor receives a message, the promise returned by the query resolves. </p>\\n<p>In addition to the message, <code>query</code> also takes in a timeout value measured in milliseconds. If a query takes longer than this time to resolve, it times out and the promise is rejected. A time bounded query is very important in a production system; it ensures that a failing subsystem does not cause cascading faults as queries queue up and stress available system resources.</p>\\n<p>In this example, we'll create a simple single user in-memory address book system.</p>\\n<blockquote>\\n<p>Note: We'll expand on this example in later sections.</p>\\n</blockquote>\\n<p>What are the basic requirements of a basic address book API? It should be able to:</p>\\n<ul>\\n<li>Create a new contact </li>\\n<li>Fetch all contacts</li>\\n<li>Fetch a specific contact</li>\\n<li>Update an existing contact</li>\\n<li>Delete a contact</li>\\n</ul>\\n<p>Because actor are message driven, let us define the message types used between the api and actor system:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-reason\\\"><code><span class=\\\"token keyword\\\">type</span> contactId <span class=\\\"token operator\\\">=</span>\\n  <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">ContactId</span><span class=\\\"token punctuation\\\">(</span>int<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">type</span> contact <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  name<span class=\\\"token punctuation\\\">:</span> string<span class=\\\"token punctuation\\\">,</span>\\n  email<span class=\\\"token punctuation\\\">:</span> string\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">type</span> contactResponseMsg <span class=\\\"token operator\\\">=</span>\\n  <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">Success</span><span class=\\\"token punctuation\\\">(</span>contact<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">NotFound</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">type</span> contactMsg <span class=\\\"token operator\\\">=</span>\\n  <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">CreateContact</span><span class=\\\"token punctuation\\\">(</span>contact<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">RemoveContact</span><span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">UpdateContact</span><span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">FindContact</span><span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<p>We also need to describe the shape of the contact actor's state. In this example, it was decided to create a <code>ContactIdMap</code> map to hold the list of contacts. <code>seqNumber</code> is used to assign each contact a unique identifier. <code>seqNumber</code> monotonically increases, even if a contact is deleted:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-reason\\\"><code><span class=\\\"token keyword\\\">module</span> <span class=\\\"token constructor variable\\\">ContactIdCompare</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">type</span> t <span class=\\\"token operator\\\">=</span> contactId<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">let</span> compare <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token constructor variable\\\">ContactId</span><span class=\\\"token punctuation\\\">(</span>left<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constructor variable\\\">ContactId</span><span class=\\\"token punctuation\\\">(</span>right<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> compare<span class=\\\"token punctuation\\\">(</span>left<span class=\\\"token punctuation\\\">,</span> right<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">module</span> <span class=\\\"token constructor variable\\\">ContactIdMap</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token class-name\\\">Map</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token constructor variable\\\">Make</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token constructor variable\\\">ContactIdCompare</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">type</span> contactsServiceState <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  contacts<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token class-name\\\">ContactIdMap</span><span class=\\\"token punctuation\\\">.</span>t<span class=\\\"token punctuation\\\">(</span>contact<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n  seqNumber<span class=\\\"token punctuation\\\">:</span> int\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<p>Now let us create functions to handle each message type:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-reason\\\"><code><span class=\\\"token keyword\\\">let</span> createContact <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> contactId <span class=\\\"token operator\\\">=</span> <span class=\\\"token constructor variable\\\">ContactId</span><span class=\\\"token punctuation\\\">(</span>seqNumber<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  sender <span class=\\\"token operator\\\">&lt;</span><span class=\\\"token operator\\\">-</span><span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constructor variable\\\">Success</span><span class=\\\"token punctuation\\\">(</span>contact<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">let</span> nextContacts <span class=\\\"token operator\\\">=</span> <span class=\\\"token class-name\\\">ContactIdMap</span><span class=\\\"token punctuation\\\">.</span>add<span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">,</span> contacts<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">:</span> nextContacts<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">:</span> seqNumber <span class=\\\"token operator\\\">+</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> removeContact <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> nextContacts <span class=\\\"token operator\\\">=</span> <span class=\\\"token class-name\\\">ContactIdMap</span><span class=\\\"token punctuation\\\">.</span>remove<span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> contacts<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">let</span> msg <span class=\\\"token operator\\\">=</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>contacts <span class=\\\"token operator\\\">===</span> nextContacts<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">let</span> contact <span class=\\\"token operator\\\">=</span> <span class=\\\"token class-name\\\">ContactIdMap</span><span class=\\\"token punctuation\\\">.</span>find<span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> contacts<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constructor variable\\\">Success</span><span class=\\\"token punctuation\\\">(</span>contact<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constructor variable\\\">NotFound</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n  sender <span class=\\\"token operator\\\">&lt;</span><span class=\\\"token operator\\\">-</span><span class=\\\"token operator\\\">&lt;</span> msg<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">:</span> nextContacts<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> updateContact <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> nextContacts <span class=\\\"token operator\\\">=</span>\\n    <span class=\\\"token class-name\\\">ContactIdMap</span><span class=\\\"token punctuation\\\">.</span>remove<span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> contacts<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">|</span><span class=\\\"token operator\\\">></span> <span class=\\\"token class-name\\\">ContactIdMap</span><span class=\\\"token punctuation\\\">.</span>add<span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">let</span> msg <span class=\\\"token operator\\\">=</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>nextContacts <span class=\\\"token operator\\\">===</span> contacts<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constructor variable\\\">Success</span><span class=\\\"token punctuation\\\">(</span>contact<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constructor variable\\\">NotFound</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n  sender <span class=\\\"token operator\\\">&lt;</span><span class=\\\"token operator\\\">-</span><span class=\\\"token operator\\\">&lt;</span> msg<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">:</span> nextContacts<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> findContact <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> msg <span class=\\\"token operator\\\">=</span>\\n    <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constructor variable\\\">Success</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token class-name\\\">ContactIdMap</span><span class=\\\"token punctuation\\\">.</span>find<span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> contacts<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">Not_found</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constructor variable\\\">NotFound</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n  sender <span class=\\\"token operator\\\">&lt;</span><span class=\\\"token operator\\\">-</span><span class=\\\"token operator\\\">&lt;</span> msg<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<p>Finally we can put it all together and create the actor:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-reason\\\"><code><span class=\\\"token keyword\\\">let</span> system <span class=\\\"token operator\\\">=</span> start<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> contactsService <span class=\\\"token operator\\\">=</span>\\n  spawn<span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token operator\\\">~</span>name<span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"contacts\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    system<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>sender<span class=\\\"token punctuation\\\">,</span> msg<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> _<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span>\\n      <span class=\\\"token punctuation\\\">(</span>\\n        <span class=\\\"token keyword\\\">switch</span> msg <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">CreateContact</span><span class=\\\"token punctuation\\\">(</span>contact<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> createContact<span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">RemoveContact</span><span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> removeContact<span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">UpdateContact</span><span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> updateContact<span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">FindContact</span><span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> findContact<span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token operator\\\">|</span><span class=\\\"token operator\\\">></span> <span class=\\\"token class-name\\\">Js</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token class-name\\\">Promise</span><span class=\\\"token punctuation\\\">.</span>resolve<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token class-name\\\">ContactIdMap</span><span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<p>This should leave you with a working but very basic contacts service.\\nWe can now interact with this actor from outside the actor system by calling the query function. In the example below, we are passing in a\\nfunction which constructs the final message to sender to the contactsService actor:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-reason\\\"><code><span class=\\\"token keyword\\\">let</span> createDinesh <span class=\\\"token operator\\\">=</span> query<span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token operator\\\">~</span>timeout<span class=\\\"token operator\\\">=</span><span class=\\\"token number\\\">100</span> <span class=\\\"token operator\\\">*</span> milliseconds<span class=\\\"token punctuation\\\">,</span>\\n    contactsService<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">(</span>tempReference<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">(</span>\\n      tempReference<span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token constructor variable\\\">CreateContact</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>name<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">\\\"Dinesh Chugtai\\\"</span><span class=\\\"token punctuation\\\">,</span> email<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">\\\"dinesh@piedpiper.com\\\"</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<h2 id=\\\"hierarchy\\\"><a href=\\\"#hierarchy\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Hierarchy</h2>\\n<p>The application we made in the <a href=\\\"#querying\\\">querying</a> section isn't very useful. For one it only supports a single user's contacts, and secondly it forgets all the user's contacts whenever the system restarts. In this section we'll solve the multi-user problem by exploiting an important feature of any blue-blooded actor system: the hierachy.</p>\\n<p>Actors are arranged hierarchially, they can create child actors of their own, and accordingly every actor has a parent. The lifecycle of an actor is tied to its parent; if an actor stops, then it's children do too.</p>\\n<p>Up till now we've been creating actors which are children of the actor system (which is a pseudo actor). However in a real system, this would be considered an anti pattern, for much the same reasons as placing all your code in a single file is an anti-pattern. By exploiting the actor hierarchy, you can enforce a separation of concerns and encapsulate system functionality, while providing a coherent means of reasoning with failure and system shutdown. </p>\\n<p>Let us imagine that the single user contacts service was simple a part of some larger system; an email campaign management API for example.  A potentially valid system could perhaps be represented by the diagram below. </p>\\n<img src=\\\"https://raw.githubusercontent.com/ncthbrt/nact/master/assets/hierarchy-diagram.svg?sanitize=true\\\" alt=\\\"Example of an Actor System Hierarchy\\\">\\n<p>In the diagram, the email service is responsible for managing the template engine and email delivery, while the contacts service has choosen to model each user's contacts as an actor. (This is a very feasible approach in production provided you shutdown actors after a period of inactivity)</p>\\n<p>Let us focus on the contacts service to see how we can make effective of use of the hierarchy. To support multiple users, we need do three things: </p>\\n<ul>\\n<li>Modify our original contacts service to so that we can parameterise its parent and name</li>\\n<li>Create a parent to route requests to the correct child</li>\\n<li>Add a user id to the path of each API endpoint and add a <code>userId</code> into each message.</li>\\n</ul>\\n<p>Modifying our original service is as simple as the following:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-reason\\\"><code><span class=\\\"token keyword\\\">let</span> createContactsService <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>parent<span class=\\\"token punctuation\\\">,</span> userId<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span>\\n  spawn<span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token operator\\\">~</span>name<span class=\\\"token operator\\\">=</span>userId<span class=\\\"token punctuation\\\">,</span>\\n    parent<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>sender<span class=\\\"token punctuation\\\">,</span> msg<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> _<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span>\\n      <span class=\\\"token punctuation\\\">(</span>\\n        <span class=\\\"token keyword\\\">switch</span> msg <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">CreateContact</span><span class=\\\"token punctuation\\\">(</span>contact<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> createContact<span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">RemoveContact</span><span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> removeContact<span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">UpdateContact</span><span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> updateContact<span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">FindContact</span><span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> findContact<span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token operator\\\">|</span><span class=\\\"token operator\\\">></span> <span class=\\\"token class-name\\\">Js</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token class-name\\\">Promise</span><span class=\\\"token punctuation\\\">.</span>resolve<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token class-name\\\">ContactIdMap</span><span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<p>Now we need to create the parent contact service. The parent checks if it has a child with the userId as the key. If it does not, it spawns the\\nchild actor:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-reason\\\"><code><span class=\\\"token keyword\\\">let</span> contactsService <span class=\\\"token operator\\\">=</span>\\n  spawn<span class=\\\"token punctuation\\\">(</span>\\n    system<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">(</span>children<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>sender<span class=\\\"token punctuation\\\">,</span> userId<span class=\\\"token punctuation\\\">,</span> msg<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> ctx<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">let</span> potentialChild <span class=\\\"token operator\\\">=</span>\\n        <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token constructor variable\\\">Some</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token class-name\\\">StringMap</span><span class=\\\"token punctuation\\\">.</span>find<span class=\\\"token punctuation\\\">(</span>userId<span class=\\\"token punctuation\\\">,</span> children<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token operator\\\">|</span> _ <span class=\\\"token operator\\\">=></span> <span class=\\\"token constructor variable\\\">None</span>\\n        <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token class-name\\\">Js</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token class-name\\\">Promise</span><span class=\\\"token punctuation\\\">.</span>resolve<span class=\\\"token punctuation\\\">(</span>\\n        <span class=\\\"token keyword\\\">switch</span> potentialChild <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">Some</span><span class=\\\"token punctuation\\\">(</span>child<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span>\\n          dispatch<span class=\\\"token punctuation\\\">(</span>child<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>sender<span class=\\\"token punctuation\\\">,</span> msg<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n          children\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">None</span> <span class=\\\"token operator\\\">=></span>\\n          <span class=\\\"token keyword\\\">let</span> child <span class=\\\"token operator\\\">=</span> createContactsService<span class=\\\"token punctuation\\\">(</span>ctx<span class=\\\"token punctuation\\\">.</span>self<span class=\\\"token punctuation\\\">,</span> userId<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n          dispatch<span class=\\\"token punctuation\\\">(</span>child<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>sender<span class=\\\"token punctuation\\\">,</span> msg<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n          <span class=\\\"token class-name\\\">StringMap</span><span class=\\\"token punctuation\\\">.</span>add<span class=\\\"token punctuation\\\">(</span>userId<span class=\\\"token punctuation\\\">,</span> child<span class=\\\"token punctuation\\\">,</span> children<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token class-name\\\">StringMap</span><span class=\\\"token punctuation\\\">.</span>empty\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<p>These two modifications show the power of an actor hierarchy. The contact service doesn't need to know the implementation details of its children (and doesn't even have to know about what kind of messages the children can handle). The children also don't need to worry about multi tenancy and can focus on the domain.</p>\\n<p>Now the only thing remaining for a MVP of our contacts service is some way of persisting changes...</p>\",\n\t\t\t\t\"timeToRead\": 6,\n\t\t\t\t\"excerpt\": \"Actor systems don't live in a vacuum, they need to be available to the outside world. Commonly actor systems are fronted by REST APIs or RPC...\",\n\t\t\t\t\"frontmatter\": {\n\t\t\t\t\t\"title\": \"Querying\",\n\t\t\t\t\t\"cover\": \"https://unsplash.it/400/300/?random?BoldMage\",\n\t\t\t\t\t\"date\": \"11/12/2017\",\n\t\t\t\t\t\"category\": \"reasonml\",\n\t\t\t\t\t\"tags\": [\n\t\t\t\t\t\t\"getting-started\",\n\t\t\t\t\t\t\"nact\",\n\t\t\t\t\t\t\"reason\",\n\t\t\t\t\t\t\"bucklescript\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t\"fields\": {\n\t\t\t\t\t\"slug\": \"/querying\"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"pathContext\": {\n\t\t\t\"slug\": \"/querying\",\n\t\t\t\"category\": \"reasonml\"\n\t\t}\n\t};\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---lesson-reasonml-querying-802e8d6b8746e79dae24.js","module.exports = {\n\t\"data\": {\n\t\t\"allPostTitles\": {\n\t\t\t\"edges\": [\n\t\t\t\t{\n\t\t\t\t\t\"node\": {\n\t\t\t\t\t\t\"frontmatter\": {\n\t\t\t\t\t\t\t\"title\": \"Persist\",\n\t\t\t\t\t\t\t\"lesson\": 1,\n\t\t\t\t\t\t\t\"category\": \"reasonml\",\n\t\t\t\t\t\t\t\"chapter\": 3,\n\t\t\t\t\t\t\t\"type\": \"lesson\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"fields\": {\n\t\t\t\t\t\t\t\"slug\": \"/persist\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"node\": {\n\t\t\t\t\t\t\"frontmatter\": {\n\t\t\t\t\t\t\t\"title\": \"Getting Started\",\n\t\t\t\t\t\t\t\"lesson\": 1,\n\t\t\t\t\t\t\t\"category\": \"reasonml\",\n\t\t\t\t\t\t\t\"chapter\": 2,\n\t\t\t\t\t\t\t\"type\": \"lesson\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"fields\": {\n\t\t\t\t\t\t\t\"slug\": \"/getting-started\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"node\": {\n\t\t\t\t\t\t\"frontmatter\": {\n\t\t\t\t\t\t\t\"title\": \"Actor Communication\",\n\t\t\t\t\t\t\t\"lesson\": 3,\n\t\t\t\t\t\t\t\"category\": \"reasonml\",\n\t\t\t\t\t\t\t\"chapter\": 2,\n\t\t\t\t\t\t\t\"type\": \"lesson\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"fields\": {\n\t\t\t\t\t\t\t\"slug\": \"/actor-communication\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"node\": {\n\t\t\t\t\t\t\"frontmatter\": {\n\t\t\t\t\t\t\t\"title\": \"Introduction\",\n\t\t\t\t\t\t\t\"lesson\": 1,\n\t\t\t\t\t\t\t\"category\": \"reasonml\",\n\t\t\t\t\t\t\t\"chapter\": 1,\n\t\t\t\t\t\t\t\"type\": \"lesson\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"fields\": {\n\t\t\t\t\t\t\t\"slug\": \"/introduction\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"node\": {\n\t\t\t\t\t\t\"frontmatter\": {\n\t\t\t\t\t\t\t\"title\": \"Snapshotting\",\n\t\t\t\t\t\t\t\"lesson\": 2,\n\t\t\t\t\t\t\t\"category\": \"reasonml\",\n\t\t\t\t\t\t\t\"chapter\": 3,\n\t\t\t\t\t\t\t\"type\": \"lesson\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"fields\": {\n\t\t\t\t\t\t\t\"slug\": \"/snapshotting\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"node\": {\n\t\t\t\t\t\t\"frontmatter\": {\n\t\t\t\t\t\t\t\"title\": \"Timeouts\",\n\t\t\t\t\t\t\t\"lesson\": 3,\n\t\t\t\t\t\t\t\"category\": \"reasonml\",\n\t\t\t\t\t\t\t\"chapter\": 3,\n\t\t\t\t\t\t\t\"type\": \"lesson\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"fields\": {\n\t\t\t\t\t\t\t\"slug\": \"/timeouts\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"node\": {\n\t\t\t\t\t\t\"frontmatter\": {\n\t\t\t\t\t\t\t\"title\": \"Stateful Actors\",\n\t\t\t\t\t\t\t\"lesson\": 2,\n\t\t\t\t\t\t\t\"category\": \"reasonml\",\n\t\t\t\t\t\t\t\"chapter\": 2,\n\t\t\t\t\t\t\t\"type\": \"lesson\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"fields\": {\n\t\t\t\t\t\t\t\"slug\": \"/stateful-actors\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"node\": {\n\t\t\t\t\t\t\"frontmatter\": {\n\t\t\t\t\t\t\t\"title\": \"Querying\",\n\t\t\t\t\t\t\t\"lesson\": 4,\n\t\t\t\t\t\t\t\"category\": \"reasonml\",\n\t\t\t\t\t\t\t\"chapter\": 2,\n\t\t\t\t\t\t\t\"type\": \"lesson\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"fields\": {\n\t\t\t\t\t\t\t\"slug\": \"/querying\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t\"postBySlug\": {\n\t\t\t\"html\": \"<p>Actor systems don't live in a vacuum, they need to be available to the outside world. Commonly actor systems are fronted by REST APIs or RPC frameworks. REST and RPC style access patterns are blocking: a request comes in, it is processed, and finally returned to the sender using the original connection. To help bridge nact's non blocking nature, Nact provides a <code>query</code> function. Query returns a promise.</p>\\n<p>Similar to <code>dispatch</code>, <code>query</code> pushes a message on to an actor's mailbox, but differs in that it also creates a temporary actor. The temporary actor is passed into a function which returns the message to send to the target actor. When the temporary actor receives a message, the promise returned by the query resolves. </p>\\n<p>In addition to the message, <code>query</code> also takes in a timeout value measured in milliseconds. If a query takes longer than this time to resolve, it times out and the promise is rejected. A time bounded query is very important in a production system; it ensures that a failing subsystem does not cause cascading faults as queries queue up and stress available system resources.</p>\\n<p>In this example, we'll create a simple single user in-memory address book system.</p>\\n<blockquote>\\n<p>Note: We'll expand on this example in later sections.</p>\\n</blockquote>\\n<p>What are the basic requirements of a basic address book API? It should be able to:</p>\\n<ul>\\n<li>Create a new contact </li>\\n<li>Fetch all contacts</li>\\n<li>Fetch a specific contact</li>\\n<li>Update an existing contact</li>\\n<li>Delete a contact</li>\\n</ul>\\n<p>Because actor are message driven, let us define the message types used between the api and actor system:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-reason\\\"><code><span class=\\\"token keyword\\\">type</span> contactId <span class=\\\"token operator\\\">=</span>\\n  <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">ContactId</span><span class=\\\"token punctuation\\\">(</span>int<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">type</span> contact <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  name<span class=\\\"token punctuation\\\">:</span> string<span class=\\\"token punctuation\\\">,</span>\\n  email<span class=\\\"token punctuation\\\">:</span> string\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">type</span> contactResponseMsg <span class=\\\"token operator\\\">=</span>\\n  <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">Success</span><span class=\\\"token punctuation\\\">(</span>contact<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">NotFound</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">type</span> contactMsg <span class=\\\"token operator\\\">=</span>\\n  <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">CreateContact</span><span class=\\\"token punctuation\\\">(</span>contact<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">RemoveContact</span><span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">UpdateContact</span><span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">FindContact</span><span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<p>We also need to describe the shape of the contact actor's state. In this example, it was decided to create a <code>ContactIdMap</code> map to hold the list of contacts. <code>seqNumber</code> is used to assign each contact a unique identifier. <code>seqNumber</code> monotonically increases, even if a contact is deleted:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-reason\\\"><code><span class=\\\"token keyword\\\">module</span> <span class=\\\"token constructor variable\\\">ContactIdCompare</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">type</span> t <span class=\\\"token operator\\\">=</span> contactId<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">let</span> compare <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token constructor variable\\\">ContactId</span><span class=\\\"token punctuation\\\">(</span>left<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constructor variable\\\">ContactId</span><span class=\\\"token punctuation\\\">(</span>right<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> compare<span class=\\\"token punctuation\\\">(</span>left<span class=\\\"token punctuation\\\">,</span> right<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">module</span> <span class=\\\"token constructor variable\\\">ContactIdMap</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token class-name\\\">Map</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token constructor variable\\\">Make</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token constructor variable\\\">ContactIdCompare</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">type</span> contactsServiceState <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  contacts<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token class-name\\\">ContactIdMap</span><span class=\\\"token punctuation\\\">.</span>t<span class=\\\"token punctuation\\\">(</span>contact<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n  seqNumber<span class=\\\"token punctuation\\\">:</span> int\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<p>Now let us create functions to handle each message type:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-reason\\\"><code><span class=\\\"token keyword\\\">let</span> createContact <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> contactId <span class=\\\"token operator\\\">=</span> <span class=\\\"token constructor variable\\\">ContactId</span><span class=\\\"token punctuation\\\">(</span>seqNumber<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  sender <span class=\\\"token operator\\\">&lt;</span><span class=\\\"token operator\\\">-</span><span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constructor variable\\\">Success</span><span class=\\\"token punctuation\\\">(</span>contact<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">let</span> nextContacts <span class=\\\"token operator\\\">=</span> <span class=\\\"token class-name\\\">ContactIdMap</span><span class=\\\"token punctuation\\\">.</span>add<span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">,</span> contacts<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">:</span> nextContacts<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">:</span> seqNumber <span class=\\\"token operator\\\">+</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> removeContact <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> nextContacts <span class=\\\"token operator\\\">=</span> <span class=\\\"token class-name\\\">ContactIdMap</span><span class=\\\"token punctuation\\\">.</span>remove<span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> contacts<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">let</span> msg <span class=\\\"token operator\\\">=</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>contacts <span class=\\\"token operator\\\">===</span> nextContacts<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">let</span> contact <span class=\\\"token operator\\\">=</span> <span class=\\\"token class-name\\\">ContactIdMap</span><span class=\\\"token punctuation\\\">.</span>find<span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> contacts<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constructor variable\\\">Success</span><span class=\\\"token punctuation\\\">(</span>contact<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constructor variable\\\">NotFound</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n  sender <span class=\\\"token operator\\\">&lt;</span><span class=\\\"token operator\\\">-</span><span class=\\\"token operator\\\">&lt;</span> msg<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">:</span> nextContacts<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> updateContact <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> nextContacts <span class=\\\"token operator\\\">=</span>\\n    <span class=\\\"token class-name\\\">ContactIdMap</span><span class=\\\"token punctuation\\\">.</span>remove<span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> contacts<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">|</span><span class=\\\"token operator\\\">></span> <span class=\\\"token class-name\\\">ContactIdMap</span><span class=\\\"token punctuation\\\">.</span>add<span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">let</span> msg <span class=\\\"token operator\\\">=</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>nextContacts <span class=\\\"token operator\\\">===</span> contacts<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constructor variable\\\">Success</span><span class=\\\"token punctuation\\\">(</span>contact<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constructor variable\\\">NotFound</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n  sender <span class=\\\"token operator\\\">&lt;</span><span class=\\\"token operator\\\">-</span><span class=\\\"token operator\\\">&lt;</span> msg<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">:</span> nextContacts<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> findContact <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> msg <span class=\\\"token operator\\\">=</span>\\n    <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constructor variable\\\">Success</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token class-name\\\">ContactIdMap</span><span class=\\\"token punctuation\\\">.</span>find<span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> contacts<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">Not_found</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constructor variable\\\">NotFound</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n  sender <span class=\\\"token operator\\\">&lt;</span><span class=\\\"token operator\\\">-</span><span class=\\\"token operator\\\">&lt;</span> msg<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<p>Finally we can put it all together and create the actor:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-reason\\\"><code><span class=\\\"token keyword\\\">let</span> system <span class=\\\"token operator\\\">=</span> start<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> contactsService <span class=\\\"token operator\\\">=</span>\\n  spawn<span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token operator\\\">~</span>name<span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"contacts\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    system<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>sender<span class=\\\"token punctuation\\\">,</span> msg<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> _<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span>\\n      <span class=\\\"token punctuation\\\">(</span>\\n        <span class=\\\"token keyword\\\">switch</span> msg <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">CreateContact</span><span class=\\\"token punctuation\\\">(</span>contact<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> createContact<span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">RemoveContact</span><span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> removeContact<span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">UpdateContact</span><span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> updateContact<span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">FindContact</span><span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> findContact<span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token operator\\\">|</span><span class=\\\"token operator\\\">></span> <span class=\\\"token class-name\\\">Js</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token class-name\\\">Promise</span><span class=\\\"token punctuation\\\">.</span>resolve<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token class-name\\\">ContactIdMap</span><span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<p>This should leave you with a working but very basic contacts service.\\nWe can now interact with this actor from outside the actor system by calling the query function. In the example below, we are passing in a\\nfunction which constructs the final message to sender to the contactsService actor:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-reason\\\"><code><span class=\\\"token keyword\\\">let</span> createDinesh <span class=\\\"token operator\\\">=</span> query<span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token operator\\\">~</span>timeout<span class=\\\"token operator\\\">=</span><span class=\\\"token number\\\">100</span> <span class=\\\"token operator\\\">*</span> milliseconds<span class=\\\"token punctuation\\\">,</span>\\n    contactsService<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">(</span>tempReference<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">(</span>\\n      tempReference<span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token constructor variable\\\">CreateContact</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>name<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">\\\"Dinesh Chugtai\\\"</span><span class=\\\"token punctuation\\\">,</span> email<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">\\\"dinesh@piedpiper.com\\\"</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<h2 id=\\\"hierarchy\\\"><a href=\\\"#hierarchy\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Hierarchy</h2>\\n<p>The application we made in the <a href=\\\"#querying\\\">querying</a> section isn't very useful. For one it only supports a single user's contacts, and secondly it forgets all the user's contacts whenever the system restarts. In this section we'll solve the multi-user problem by exploiting an important feature of any blue-blooded actor system: the hierachy.</p>\\n<p>Actors are arranged hierarchially, they can create child actors of their own, and accordingly every actor has a parent. The lifecycle of an actor is tied to its parent; if an actor stops, then it's children do too.</p>\\n<p>Up till now we've been creating actors which are children of the actor system (which is a pseudo actor). However in a real system, this would be considered an anti pattern, for much the same reasons as placing all your code in a single file is an anti-pattern. By exploiting the actor hierarchy, you can enforce a separation of concerns and encapsulate system functionality, while providing a coherent means of reasoning with failure and system shutdown. </p>\\n<p>Let us imagine that the single user contacts service was simple a part of some larger system; an email campaign management API for example.  A potentially valid system could perhaps be represented by the diagram below. </p>\\n<img src=\\\"https://raw.githubusercontent.com/ncthbrt/nact/master/assets/hierarchy-diagram.svg?sanitize=true\\\" alt=\\\"Example of an Actor System Hierarchy\\\">\\n<p>In the diagram, the email service is responsible for managing the template engine and email delivery, while the contacts service has choosen to model each user's contacts as an actor. (This is a very feasible approach in production provided you shutdown actors after a period of inactivity)</p>\\n<p>Let us focus on the contacts service to see how we can make effective of use of the hierarchy. To support multiple users, we need do three things: </p>\\n<ul>\\n<li>Modify our original contacts service to so that we can parameterise its parent and name</li>\\n<li>Create a parent to route requests to the correct child</li>\\n<li>Add a user id to the path of each API endpoint and add a <code>userId</code> into each message.</li>\\n</ul>\\n<p>Modifying our original service is as simple as the following:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-reason\\\"><code><span class=\\\"token keyword\\\">let</span> createContactsService <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>parent<span class=\\\"token punctuation\\\">,</span> userId<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span>\\n  spawn<span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token operator\\\">~</span>name<span class=\\\"token operator\\\">=</span>userId<span class=\\\"token punctuation\\\">,</span>\\n    parent<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>sender<span class=\\\"token punctuation\\\">,</span> msg<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> _<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span>\\n      <span class=\\\"token punctuation\\\">(</span>\\n        <span class=\\\"token keyword\\\">switch</span> msg <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">CreateContact</span><span class=\\\"token punctuation\\\">(</span>contact<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> createContact<span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">RemoveContact</span><span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> removeContact<span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">UpdateContact</span><span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> updateContact<span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">,</span> contact<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">FindContact</span><span class=\\\"token punctuation\\\">(</span>contactId<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> findContact<span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">,</span> sender<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token operator\\\">|</span><span class=\\\"token operator\\\">></span> <span class=\\\"token class-name\\\">Js</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token class-name\\\">Promise</span><span class=\\\"token punctuation\\\">.</span>resolve<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">{</span>contacts<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token class-name\\\">ContactIdMap</span><span class=\\\"token punctuation\\\">.</span>empty<span class=\\\"token punctuation\\\">,</span> seqNumber<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<p>Now we need to create the parent contact service. The parent checks if it has a child with the userId as the key. If it does not, it spawns the\\nchild actor:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-reason\\\"><code><span class=\\\"token keyword\\\">let</span> contactsService <span class=\\\"token operator\\\">=</span>\\n  spawn<span class=\\\"token punctuation\\\">(</span>\\n    system<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">(</span>children<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>sender<span class=\\\"token punctuation\\\">,</span> userId<span class=\\\"token punctuation\\\">,</span> msg<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> ctx<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">let</span> potentialChild <span class=\\\"token operator\\\">=</span>\\n        <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token constructor variable\\\">Some</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token class-name\\\">StringMap</span><span class=\\\"token punctuation\\\">.</span>find<span class=\\\"token punctuation\\\">(</span>userId<span class=\\\"token punctuation\\\">,</span> children<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token operator\\\">|</span> _ <span class=\\\"token operator\\\">=></span> <span class=\\\"token constructor variable\\\">None</span>\\n        <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token class-name\\\">Js</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token class-name\\\">Promise</span><span class=\\\"token punctuation\\\">.</span>resolve<span class=\\\"token punctuation\\\">(</span>\\n        <span class=\\\"token keyword\\\">switch</span> potentialChild <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">Some</span><span class=\\\"token punctuation\\\">(</span>child<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span>\\n          dispatch<span class=\\\"token punctuation\\\">(</span>child<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>sender<span class=\\\"token punctuation\\\">,</span> msg<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n          children\\n        <span class=\\\"token operator\\\">|</span> <span class=\\\"token constructor variable\\\">None</span> <span class=\\\"token operator\\\">=></span>\\n          <span class=\\\"token keyword\\\">let</span> child <span class=\\\"token operator\\\">=</span> createContactsService<span class=\\\"token punctuation\\\">(</span>ctx<span class=\\\"token punctuation\\\">.</span>self<span class=\\\"token punctuation\\\">,</span> userId<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n          dispatch<span class=\\\"token punctuation\\\">(</span>child<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>sender<span class=\\\"token punctuation\\\">,</span> msg<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n          <span class=\\\"token class-name\\\">StringMap</span><span class=\\\"token punctuation\\\">.</span>add<span class=\\\"token punctuation\\\">(</span>userId<span class=\\\"token punctuation\\\">,</span> child<span class=\\\"token punctuation\\\">,</span> children<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token class-name\\\">StringMap</span><span class=\\\"token punctuation\\\">.</span>empty\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre>\\n      </div>\\n<p>These two modifications show the power of an actor hierarchy. The contact service doesn't need to know the implementation details of its children (and doesn't even have to know about what kind of messages the children can handle). The children also don't need to worry about multi tenancy and can focus on the domain.</p>\\n<p>Now the only thing remaining for a MVP of our contacts service is some way of persisting changes...</p>\",\n\t\t\t\"timeToRead\": 6,\n\t\t\t\"excerpt\": \"Actor systems don't live in a vacuum, they need to be available to the outside world. Commonly actor systems are fronted by REST APIs or RPC...\",\n\t\t\t\"frontmatter\": {\n\t\t\t\t\"title\": \"Querying\",\n\t\t\t\t\"cover\": \"https://unsplash.it/400/300/?random?BoldMage\",\n\t\t\t\t\"date\": \"11/12/2017\",\n\t\t\t\t\"category\": \"reasonml\",\n\t\t\t\t\"tags\": [\n\t\t\t\t\t\"getting-started\",\n\t\t\t\t\t\"nact\",\n\t\t\t\t\t\"reason\",\n\t\t\t\t\t\"bucklescript\"\n\t\t\t\t]\n\t\t\t},\n\t\t\t\"fields\": {\n\t\t\t\t\"slug\": \"/querying\"\n\t\t\t}\n\t\t}\n\t},\n\t\"pathContext\": {\n\t\t\"slug\": \"/querying\",\n\t\t\"category\": \"reasonml\"\n\t}\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/lesson-reasonml-querying.json\n// module id = ./node_modules/json-loader/index.js!./.cache/json/lesson-reasonml-querying.json\n// module chunks = 2247064940371686400"],"sourceRoot":""}